<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GIPER X</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
        height: 100vh;
        background: url('bak.jpg') no-repeat center center fixed;
        background-size: cover;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .loading {
        margin: 20px auto;
        font-size: 18px;
        color: #fff;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 5px;
    }
    #predictionCard {
        opacity: 0;
        transform: scale(0.9) translateY(50px);
        margin: auto;
        padding: 20px;
        border-radius: 10px;
        background-color: rgba(255, 255, 255, 0.9);
        max-width: 300px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #predictionCard.visible-card {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
    .prediction-img {
        width: 50px;
        height: 50px;
        margin: 5px;
    }
    #controls {
        display: flex;
        justify-content: space-between;
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, 0.5);
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
    }
    .control-button {
        background-color: #fff;
        color: #007bff;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .control-button:hover {
        background-color: #007bff;
        color: #fff;
    }
    .control-button:disabled {
        background-color: #ccc;
        color: #777;
        cursor: not-allowed;
        opacity: 0.7;
    }
    #from {
       display: flex;
       justify-content: center;
       padding: 10px 20px;
       background-color: rgba(0, 0, 0, 0.5);
       position: fixed;
       left: 50%;
       bottom: 50px;
       transform: translateX(-50%);
       width: 80%;
       border-radius: 8px;
       box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .display-text {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        text-align: center;
        color: white;
        background: transparent;
        border: 2px solid white;
        border-radius: 10px;
        pointer-events: none;
    }
    .logo {
        position: fixed;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
    }
    .logo img {
        max-width: 200px;
        height: auto;
    }
</style>
</head>
<body>

<div class="loading" id="statusBar">GIPER PREMIUM</div>
<div class="logo"><img src="logo.png" alt="Logo"></div>

<div id="predictionCard">
    <h3 id="predictionNumber"></h3>
    <div id="predictionImages" style="display:flex; justify-content:center; flex-wrap:wrap;"></div>
</div>

<div id="from">
    <div class="display-text">GIPER PREMIUM SCRIPT</div>
</div>

<div id="controls">
    <button id="prevButton" class="control-button">previous</button>
    <button id="startButton" class="control-button">start</button>
    <button id="nextButton" class="control-button">next</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyB1_XCbC777hKwxlilhMeq5Hpty1dvDT1I",
    authDomain: "giper-8fd92.firebaseapp.com",
    databaseURL: "https://giper-8fd92-default-rtdb.firebaseio.com",
    projectId: "giper-8fd92",
    storageBucket: "giper-8fd92.appspot.com",
    messagingSenderId: "485740337398",
    appId: "1:485740337398:web:ab901fd4f28219ea5834d7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Bosqichlar
const steps = [
    "XBET_1_23", "XBET_1_54", "XBET_1_93", "XBET_2_41",
    "XBET_4_02", "XBET_6_71", "XBET_11_18", "XBET_27_92",
    "XBET_69_93", "XBET_349_68"
];

let currentIndex = -1;
let userId = null;

// Bool coercion
function coerceBool(v) {
    if (typeof v === 'boolean') return v;
    if (typeof v === 'string') return v.trim().toLowerCase() === 'true';
    return false;
}
function boolToImg(isTrue) {
    return isTrue ? 'appleHealthy.png' : 'appleRotten.png';
}

function updateButtonsState() {
    document.getElementById('nextButton').disabled = !(currentIndex >= 0 && currentIndex < steps.length - 1);
    document.getElementById('prevButton').disabled = !(currentIndex > 0);
}

// Auto set userId (hidden in UI)
(function autoSetUserId(){
    const defaultId = "zzgDSXVSruM9hv2eOB9U8svBqQD2";
    localStorage.setItem('userId', defaultId);
    userId = defaultId;
})();

// Init UI
(function initUI() {
    const container = document.getElementById('predictionImages');
    container.innerHTML = '';
    for (let i = 0; i < 5; i++) {
        const img = document.createElement('img');
        img.src = 'hidden.png';
        img.classList.add('prediction-img');
        container.appendChild(img);
    }
    document.getElementById('predictionNumber').textContent = '';
    document.getElementById('predictionCard').classList.add('visible-card');
})();

function showPredictionFromFirebase() {
    const stepKey = steps[currentIndex];
    document.getElementById('statusBar').textContent = 'Loading...';
    db.ref(`${stepKey}/${userId}`).once('value').then(snap => {
        const v = snap.val() || {};
        const arr = [
            coerceBool(v.apple1),
            coerceBool(v.apple2),
            coerceBool(v.apple3),
            coerceBool(v.apple4),
            coerceBool(v.apple5)
        ];
        renderApples(arr, stepKey);
        updateButtonsState();
    }).catch(() => {
        document.getElementById('statusBar').textContent = 'Error loading data';
    });
}

function renderApples(arr, stepKey) {
    const card = document.getElementById('predictionCard');
    card.classList.remove('visible-card');
    setTimeout(() => {
        const container = document.getElementById('predictionImages');
        container.innerHTML = '';
        arr.reverse().forEach((b) => {
            const img = document.createElement('img');
            img.src = boolToImg(b);
            img.classList.add('prediction-img');
            container.appendChild(img);
        });
        document.getElementById('predictionNumber').textContent = stepKey.replace('XBET_', '').replace('_', '.');
        document.getElementById('statusBar').textContent = 'GIPER PREMIUM';
        card.classList.add('visible-card');
    }, 250);
}

// Controls
function startPrediction() { currentIndex = 0; showPredictionFromFirebase(); }
function nextPrediction() { if (currentIndex < steps.length - 1) { currentIndex++; showPredictionFromFirebase(); } }
function prevPrediction() { if (currentIndex > 0) { currentIndex--; showPredictionFromFirebase(); } }

document.getElementById('startButton').addEventListener('click', startPrediction);
document.getElementById('nextButton').addEventListener('click', nextPrediction);
document.getElementById('prevButton').addEventListener('click', prevPrediction);

updateButtonsState();
</script>
</body>
</html>